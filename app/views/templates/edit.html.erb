<% if current_user.created_at > 2.weeks.ago || params[:tour] == 'true' %>
  <% user_config = current_user.user_configs.find_or_initialize_by(key: UserConfig::SHOW_APP_TOUR) %>
  <% @show_tour_start_form = user_config.new_record? && !params.key?(:tour) %>
  <% if user_config.new_record? || user_config.value || params[:tour] == 'true' %>
    <app-tour data-show-tour="<%= params[:tour] == 'true' || user_config.value %>" data-type="builder" data-next-page-path="<%= template_path(@template, params.permit(:tour)) %>" data-i18n="<%= t('app_tour').to_json %>"></app-tour>
    <%= button_to nil, user_configs_path, method: :post, params: { user_config: { key: UserConfig::SHOW_APP_TOUR, value: true } }, class: 'hidden', id: 'start_tour_button' %>
  <% end %>
<% end %>
<div class="flex items-center justify-between px-4 py-2 bg-base-100 border-b border-base-300" style="position: sticky; top: 0; z-index: 50;">
  <a href="<%= root_path %>" class="btn btn-sm btn-ghost gap-1">
    <%= svg_icon('arrow_left', class: 'w-5 h-5') %>
    <span class="hidden md:inline"><%= t('back') %></span>
  </a>
  <a href="<%= template_path(@template) %>" class="btn btn-sm btn-outline gap-1">
    <%= svg_icon('list', class: 'w-5 h-5') %>
    <span><%= t('submissions') %></span>
  </a>
</div>
<template-builder class="grid" data-template="<%= @template_data %>" data-custom-fields="<%= (current_account.account_configs.find_or_initialize_by(key: AccountConfig::TEMPLATE_CUSTOM_FIELDS_KEY).value || []).to_json %>" data-with-sign-yourself-button="<%= !@template.archived_at? %>" data-with-fields-detection="true" data-with-send-button="<%= !@template.archived_at? && can?(:create, @template.submissions.new(account: current_account)) %>" data-locale="<%= I18n.locale %>" data-show-tour-start-form="<%= @show_tour_start_form %>"></template-builder>
